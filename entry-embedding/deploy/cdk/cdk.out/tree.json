{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.214.0"},"children":{"BedrockStack":{"id":"BedrockStack","path":"BedrockStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.214.0"},"children":{"BedrockKnowledgeBaseRole":{"id":"BedrockKnowledgeBaseRole","path":"BedrockStack/BedrockKnowledgeBaseRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.214.0","metadata":[]},"children":{"ImportBedrockKnowledgeBaseRole":{"id":"ImportBedrockKnowledgeBaseRole","path":"BedrockStack/BedrockKnowledgeBaseRole/ImportBedrockKnowledgeBaseRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.214.0","metadata":[]}},"Resource":{"id":"Resource","path":"BedrockStack/BedrockKnowledgeBaseRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"bedrock.amazonaws.com"}}],"Version":"2012-10-17"},"policies":[{"policyName":"BedrockKnowledgeBasePolicy","policyDocument":{"Statement":[{"Action":["bedrock:InvokeModel","bedrock:Retrieve","bedrock:RetrieveAndGenerate"],"Effect":"Allow","Resource":"*"},{"Action":"aoss:*","Effect":"Allow","Resource":"arn:aws:aoss:us-east-1:339712825274:collection/htnuv49jy3dpgekonzrf"},{"Action":["s3:GetObject","s3:ListBucket"],"Effect":"Allow","Resource":["arn:aws:s3:::entry-python-docs-simple-339712825274-us-east-1","arn:aws:s3:::entry-python-docs-simple-339712825274-us-east-1/*"]}],"Version":"2012-10-17"}}]}}}}},"EntryPythonKnowledgeBase":{"id":"EntryPythonKnowledgeBase","path":"BedrockStack/EntryPythonKnowledgeBase","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnKnowledgeBase","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::KnowledgeBase","aws:cdk:cloudformation:props":{"knowledgeBaseConfiguration":{"type":"VECTOR","vectorKnowledgeBaseConfiguration":{"embeddingModelArn":"arn:aws:bedrock:us-east-1::foundation-model/amazon.titan-embed-text-v2:0"}},"name":"entry-python-knowledge-base","roleArn":{"Fn::GetAtt":["BedrockKnowledgeBaseRole24C5E17B","Arn"]},"storageConfiguration":{"type":"OPENSEARCH_SERVERLESS","opensearchServerlessConfiguration":{"collectionArn":"arn:aws:aoss:us-east-1:339712825274:collection/htnuv49jy3dpgekonzrf","fieldMapping":{"metadataField":"metadata","textField":"text","vectorField":"vector"},"vectorIndexName":"bedrock-knowledge-base-default-index"}}}}},"EntryPythonDataSource":{"id":"EntryPythonDataSource","path":"BedrockStack/EntryPythonDataSource","constructInfo":{"fqn":"aws-cdk-lib.aws_bedrock.CfnDataSource","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Bedrock::DataSource","aws:cdk:cloudformation:props":{"dataSourceConfiguration":{"type":"S3","s3Configuration":{"bucketArn":"arn:aws:s3:::entry-python-docs-simple-339712825274-us-east-1"}},"knowledgeBaseId":{"Fn::GetAtt":["EntryPythonKnowledgeBase","KnowledgeBaseId"]},"name":"entry-python-docs","vectorIngestionConfiguration":{"chunkingConfiguration":{"chunkingStrategy":"HIERARCHICAL","hierarchicalChunkingConfiguration":{"levelConfigurations":[{"maxTokens":1500},{"maxTokens":300}],"overlapTokens":60}},"parsingConfiguration":{"parsingStrategy":"BEDROCK_FOUNDATION_MODEL","bedrockFoundationModelConfiguration":{"modelArn":"arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-sonnet-20240229-v1:0"}}}}}},"KnowledgeBaseLambdaRole":{"id":"KnowledgeBaseLambdaRole","path":"BedrockStack/KnowledgeBaseLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.214.0","metadata":[]},"children":{"ImportKnowledgeBaseLambdaRole":{"id":"ImportKnowledgeBaseLambdaRole","path":"BedrockStack/KnowledgeBaseLambdaRole/ImportKnowledgeBaseLambdaRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.214.0","metadata":[]}},"Resource":{"id":"Resource","path":"BedrockStack/KnowledgeBaseLambdaRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"policies":[{"policyName":"KnowledgeBasePolicy","policyDocument":{"Statement":[{"Action":"bedrock:*","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"}}]}}}}},"KnowledgeBaseSyncLambda":{"id":"KnowledgeBaseSyncLambda","path":"BedrockStack/KnowledgeBaseSyncLambda","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"BedrockStack/KnowledgeBaseSyncLambda/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport boto3\nimport json\nimport time\n\ndef handler(event, context):\n    bedrock = boto3.client('bedrock-agent')\n    \n    kb_id = event['ResourceProperties']['KnowledgeBaseId']\n    ds_id = event['ResourceProperties']['DataSourceId']\n    \n    if event['RequestType'] == 'Create' or event['RequestType'] == 'Update':\n        try:\n            # 동기화 시작\n            response = bedrock.start_ingestion_job(\n                knowledgeBaseId=kb_id,\n                dataSourceId=ds_id\n            )\n            \n            job_id = response['ingestionJob']['ingestionJobId']\n            \n            # 완료 대기 (최대 10분)\n            for i in range(60):\n                job_status = bedrock.get_ingestion_job(\n                    knowledgeBaseId=kb_id,\n                    dataSourceId=ds_id,\n                    ingestionJobId=job_id\n                )\n                \n                status = job_status['ingestionJob']['status']\n                if status in ['COMPLETE', 'FAILED']:\n                    break\n                    \n                time.sleep(10)\n            \n            return {\n                'Status': 'SUCCESS',\n                'PhysicalResourceId': job_id,\n                'Data': {'JobId': job_id, 'Status': status}\n            }\n            \n        except Exception as e:\n            return {\n                'Status': 'FAILED',\n                'Reason': str(e),\n                'PhysicalResourceId': 'failed'\n            }\n    \n    return {'Status': 'SUCCESS', 'PhysicalResourceId': 'deleted'}\n"},"handler":"index.handler","role":{"Fn::GetAtt":["KnowledgeBaseLambdaRole90B393E1","Arn"]},"runtime":"python3.11","timeout":900}}}}},"KnowledgeBaseSyncCustomResource":{"id":"KnowledgeBaseSyncCustomResource","path":"BedrockStack/KnowledgeBaseSyncCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.214.0","metadata":[]},"children":{"Default":{"id":"Default","path":"BedrockStack/KnowledgeBaseSyncCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.214.0"}}}},"KnowledgeBaseId":{"id":"KnowledgeBaseId","path":"BedrockStack/KnowledgeBaseId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"DataSourceId":{"id":"DataSourceId","path":"BedrockStack/DataSourceId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"BedrockStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"BedrockStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.214.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"BedrockStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.214.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"BedrockStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.214.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}